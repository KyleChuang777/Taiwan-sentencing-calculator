<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台灣量刑區間計算器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Noto Serif TC 增加正式感 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* 基礎設定 */
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: #f3f4f6;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        /* 投影片容器 - 素雅風格 */
        .slide-paper {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 3rem;
            position: relative;
        }
        
        /* 投影片標題字型 */
        .slide-title-font {
            font-family: 'Noto Serif TC', serif;
        }

        /* 區間條 - 簡約線條設計 */
        .zone-row {
            display: flex;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s;
        }
        .zone-row:last-child {
            border-bottom: none;
        }
        .zone-row:hover {
            background-color: #fafafa;
        }
        
        /* 左側色條標示 */
        .zone-indicator {
            width: 4px;
            height: 24px;
            margin-right: 1.5rem;
            border-radius: 2px;
        }

        /* 可編輯區域的提示效果 */
        [contenteditable="true"]:hover {
            outline: 1px dashed #cbd5e1;
            cursor: text;
        }
        [contenteditable="true"]:focus {
            outline: 2px solid #3b82f6;
            background-color: #eff6ff;
            border-radius: 2px;
        }

        /* 列印專用樣式 */
        @media print {
            body * {
                visibility: hidden;
            }
            #slideContent, #slideContent * {
                visibility: visible;
            }
            #slideContent {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 2rem;
                border: none;
                box-shadow: none;
            }
            [contenteditable="true"] {
                outline: none !important;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app" class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-extrabold text-center text-gray-800 mb-6 pb-2 border-b border-gray-300 slide-title-font tracking-wide">
            量刑區間計算工具
        </h1>
        
        <!-- 輸入區塊 -->
        <div class="bg-white p-6 md:p-8 rounded-lg shadow-sm mb-8 border border-gray-200">
            <h2 class="text-lg font-bold mb-5 text-gray-700 flex items-center">
                <span class="bg-gray-800 text-white w-6 h-6 rounded-full flex items-center justify-center text-sm mr-2">1</span>
                法定本刑輸入
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- 法定本刑下限 (Statutory Minimum) - 已加入月輸入 -->
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">法定刑下限 (年/月)</label>
                    <div class="flex items-center space-x-2">
                        <input type="number" id="minYears" value="0" min="0" class="w-16 p-2 border border-gray-300 rounded focus:ring-gray-500 focus:border-gray-500 text-base">
                        <span class="text-base">年</span>
                        <input type="number" id="minMonths" value="0" min="0" class="w-16 p-2 border border-gray-300 rounded focus:ring-gray-500 focus:border-gray-500 text-base">
                        <span class="text-base">月</span>
                        <label class="flex items-center text-base text-gray-600 ml-4">
                            <input type="checkbox" id="minLife" class="form-checkbox h-5 w-5 text-gray-600 rounded focus:ring-gray-500">
                            <span class="ml-2">無期徒刑</span>
                        </label>
                    </div>
                </div>

                <!-- 法定本刑上限 (Statutory Maximum) -->
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">法定刑上限 (年)</label>
                    <div class="flex items-center space-x-4">
                        <input type="number" id="maxYears" value="0" min="0" class="w-24 p-2 border border-gray-300 rounded focus:ring-gray-500 focus:border-gray-500 text-base">
                        <label class="flex items-center text-base text-gray-600">
                            <input type="checkbox" id="maxLife" class="form-checkbox h-5 w-5 text-gray-600 rounded focus:ring-gray-500">
                            <span class="ml-2">無期徒刑</span>
                        </label>
                        <label class="flex items-center text-base text-gray-600">
                            <input type="checkbox" id="maxDeath" class="form-checkbox h-5 w-5 text-gray-600 rounded focus:ring-gray-500">
                            <span class="ml-2">死刑</span>
                        </label>
                    </div>
                </div>
            </div>

            <hr class="my-6 border-gray-100">

            <h2 class="text-lg font-bold mb-5 text-gray-700 flex items-center">
                <span class="bg-gray-800 text-white w-6 h-6 rounded-full flex items-center justify-center text-sm mr-2">2</span>
                加重與減輕因子
            </h2>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-600">加重因子次數</label>
                    <input type="number" id="aggravationCount" value="0" min="0" class="mt-1 w-full p-2 border border-gray-300 rounded text-base">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600">一般減輕因子次數</label>
                    <input type="number" id="generalMitigationCount" value="0" min="0" class="mt-1 w-full p-2 border border-gray-300 rounded text-base">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600">減輕或免除其刑</label>
                    <input type="number" id="exemptMitigationCount" value="0" min="0" class="mt-1 w-full p-2 border border-gray-300 rounded text-base">
                </div>
                <div class="flex items-end pt-2">
                    <label class="flex items-center text-base font-medium text-gray-700">
                        <input type="checkbox" id="apply59" class="form-checkbox h-5 w-5 text-gray-800 rounded focus:ring-gray-500">
                        <span class="ml-2">適用刑法第59條</span>
                    </label>
                </div>
            </div>

            <button onclick="calculateSentencingRange()" class="mt-8 w-full md:w-auto px-8 py-3 bg-gray-800 text-white font-medium rounded hover:bg-gray-900 transition shadow-sm">
                計算量刑區間
            </button>
        </div>

        <!-- 結果與控制區 -->
        <div class="bg-white p-6 md:p-8 rounded-lg shadow-sm mb-8 border border-gray-200">
            <h2 class="text-lg font-bold mb-5 text-gray-700 flex items-center">
                <span class="bg-gray-800 text-white w-6 h-6 rounded-full flex items-center justify-center text-sm mr-2">3</span>
                計算結果
            </h2>

            <div id="resultOutput" class="p-4 bg-gray-50 border border-gray-200 rounded mb-6 hidden">
                <p class="text-gray-500 text-sm mb-1">初步計算結果：</p>
                <div class="flex flex-col md:flex-row md:items-center gap-4">
                    <p id="minResult" class="text-xl font-bold text-gray-800"></p>
                    <span class="hidden md:inline text-gray-400">|</span>
                    <p id="maxResult" class="text-xl font-bold text-gray-800"></p>
                </div>
                <p id="statusMessage" class="text-base font-bold text-red-700 mt-2 hidden"></p>
            </div>

            <!-- 控制按鈕區 -->
            <div>
                <button id="divideZonesBtn" onclick="divideSentencingZones()" class="w-full md:w-auto px-6 py-3 bg-indigo-600 text-white font-medium rounded hover:bg-indigo-700 transition shadow-lg disabled:opacity-50 disabled:bg-gray-400 disabled:shadow-none" disabled>
                    區分五個量刑區間並產出投影片
                </button>
            </div>
            
            <div id="zoneErrorOutput" class="mt-4 hidden p-4 bg-red-50 text-red-700 border border-red-200 rounded"></div>
        </div>

        <!-- 投影片呈現區 (預設隱藏) -->
        <div id="slidePresentation" class="hidden mt-12 pb-20">
            <div class="flex justify-between items-center mb-4 px-2">
                <h2 class="text-xl font-bold text-gray-700">投影片預覽 (已按重度至輕度排列)</h2>
                <div class="flex gap-2">
                    <p class="text-sm text-gray-500 flex items-center mr-4">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                        點擊文字可直接編輯
                    </p>
                    <button onclick="window.print()" class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded hover:bg-blue-700 shadow-sm flex items-center transition">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                        列印 / 另存 PDF
                    </button>
                </div>
            </div>

            <!-- 真正被列印/下載的區域 -->
            <div id="slideContent" class="slide-paper max-w-3xl mx-auto rounded-none md:rounded-lg">
                <!-- 內容會由 JS 渲染 -->
            </div>
        </div>

    </div>

    <script>
        // --- 核心變數與常數 ---
        const ONE_MONTH_DAYS = 30; 
        const ONE_YEAR_DAYS = 365; 
        const TWENTY_YEARS_DAYS = 20 * ONE_YEAR_DAYS; 
        const FIFTEEN_YEARS_DAYS = 15 * ONE_YEAR_DAYS; 
        const LIFE_IMPRISONMENT = -1; 
        const DEATH_PENALTY = Infinity; 

        let calculatedRange = { min: 0, max: 0, isLife: false, isDeath: false };
        let zoneDataStore = [];

        // --- 工具函數 ---
        const TimeConverter = {
            toDays(years, months) {
                if (years === LIFE_IMPRISONMENT) return LIFE_IMPRISONMENT;
                if (years === DEATH_PENALTY) return DEATH_PENALTY;
                return (years * ONE_YEAR_DAYS) + (months * ONE_MONTH_DAYS);
            },
            fromDays(totalDays) {
                if (totalDays === LIFE_IMPRISONMENT) return { years: LIFE_IMPRISONMENT, months: 0, days: 0 };
                if (totalDays === DEATH_PENALTY) return { years: DEATH_PENALTY, months: 0, days: 0 };

                let remainingDays = Math.max(0, totalDays);
                const approximateYears = Math.ceil(remainingDays / ONE_YEAR_DAYS);
                const cleanYearDays = approximateYears * ONE_YEAR_DAYS;
                const difference = cleanYearDays - remainingDays;

                // 處理 N年 - M月 的精確減輕顯示 (餘數歸零)
                if (difference > 0 && difference % ONE_MONTH_DAYS === 0) {
                    const monthsReduced = difference / ONE_MONTH_DAYS;
                    if (monthsReduced >= 1 && monthsReduced <= 12) {
                        return { years: approximateYears - 1, months: 12 - monthsReduced, days: 0 }; 
                    }
                }
                
                const years = Math.floor(remainingDays / ONE_YEAR_DAYS);
                remainingDays = remainingDays % ONE_YEAR_DAYS;
                
                const months = Math.floor(remainingDays / ONE_MONTH_DAYS);
                
                // *** 修正點：如果總刑期超過一個月，則為了顯示整潔，忽略不足一個月的剩餘天數 (日) ***
                const days = (years > 0 || months > 0) ? 0 : remainingDays % ONE_MONTH_DAYS; 
                
                return { years, months, days };
            },
            formatDays(days) {
                if (days === DEATH_PENALTY) return '死刑';
                if (days === LIFE_IMPRISONMENT) return '無期徒刑';
                if (days <= 0) return '免除其刑';

                const { years, months, days: remainingDays } = TimeConverter.fromDays(days);
                let parts = [];
                if (years > 0) parts.push(`${years}年`);
                if (months > 0) parts.push(`${months}月`);
                if (remainingDays > 0) parts.push(`${remainingDays}日`);
                if (parts.length === 0) return '免除其刑';
                return parts.join('');
            }
        };

        // --- 核心計算 ---
        function calculateSentencingRange() {
            const statusMsg = document.getElementById('statusMessage');
            document.getElementById('resultOutput').classList.remove('hidden');
            statusMsg.classList.remove('hidden');
            statusMsg.textContent = '計算中...';
            statusMsg.className = "text-base font-bold text-gray-500 mt-2";

            try {
                document.getElementById('zoneErrorOutput').classList.add('hidden');
                document.getElementById('slidePresentation').classList.add('hidden');
                document.getElementById('divideZonesBtn').disabled = true;
                document.getElementById('minResult').textContent = ''; 
                document.getElementById('maxResult').textContent = '';
                
                // 讀取輸入
                const minYearsInput = parseInt(document.getElementById('minYears').value) || 0;
                const maxYearsInput = parseInt(document.getElementById('maxYears').value) || 0;
                const minMonthsInput = parseInt(document.getElementById('minMonths').value) || 0;
                
                const minLife = document.getElementById('minLife').checked;
                const maxLife = document.getElementById('maxLife').checked;
                const maxDeath = document.getElementById('maxDeath').checked;

                let minDays, maxDays;
                
                // 初始法定刑設定
                if (minLife) {
                    minDays = LIFE_IMPRISONMENT; // 無期徒刑
                } else {
                    // 規則：若年/月輸入皆為 0，最低為 2 個月 (60 days)
                    if (minYearsInput === 0 && minMonthsInput === 0 && !minLife) {
                        minDays = ONE_MONTH_DAYS * 2;
                    } else {
                        minDays = TimeConverter.toDays(minYearsInput, minMonthsInput);
                    }
                }
                
                maxDays = maxDeath ? DEATH_PENALTY : (maxLife ? LIFE_IMPRISONMENT : TimeConverter.toDays(maxYearsInput, 0));
                
                if (minDays !== LIFE_IMPRISONMENT && maxDays !== DEATH_PENALTY && maxDays !== LIFE_IMPRISONMENT && minDays >= maxDays) {
                    throw new Error('有期徒刑下限不能大於或等於上限');
                }

                const aggravationCount = parseInt(document.getElementById('aggravationCount').value) || 0;
                let generalMitigationCount = parseInt(document.getElementById('generalMitigationCount').value) || 0;
                const exemptMitigationCount = parseInt(document.getElementById('exemptMitigationCount').value) || 0;
                const apply59 = document.getElementById('apply59').checked;

                // 加重
                for (let i = 0; i < aggravationCount; i++) {
                    if (minDays !== LIFE_IMPRISONMENT) minDays = Math.min(minDays + ONE_MONTH_DAYS, TWENTY_YEARS_DAYS);
                    if (maxDays !== DEATH_PENALTY && maxDays !== LIFE_IMPRISONMENT) {
                        let newMax = maxDays * 1.5;
                        maxDays = Math.min(Math.floor(newMax), TWENTY_YEARS_DAYS);
                    }
                }

                // 減輕
                if (apply59) generalMitigationCount += 1;
                const minDaysBeforeMitigation = minDays;

                let currentMinLife = minLife;
                let currentMaxLife = maxLife;
                let currentMaxDeath = maxDeath;

                // 處理「減輕或免除其刑」 (三分之一減輕)
                for (let i = 0; i < exemptMitigationCount; i++) {
                    // 死刑減輕為無期徒刑，並跳過該次迴圈的其餘減輕邏輯
                    if (maxDays === DEATH_PENALTY) {
                        maxDays = LIFE_IMPRISONMENT;
                        continue; 
                    } 
                    
                    if (maxDays !== DEATH_PENALTY && maxDays !== LIFE_IMPRISONMENT) {
                        maxDays = Math.max(0, maxDays - ONE_MONTH_DAYS);
                    } else if (maxDays === LIFE_IMPRISONMENT) {
                        maxDays = TimeConverter.toDays(20, 0);
                    }
                    if (minDays !== LIFE_IMPRISONMENT) minDays = Math.floor(minDays / 3);
                    else { minDays = FIFTEEN_YEARS_DAYS; }
                }

                // 處理「一般減輕因子」 (二分之一減輕)
                for (let i = 0; i < generalMitigationCount; i++) {
                    // 死刑減輕為無期徒刑，並跳過該次迴圈的其餘減輕邏輯
                    if (maxDays === DEATH_PENALTY) {
                        maxDays = LIFE_IMPRISONMENT;
                        continue; 
                    } 
                    
                    if (maxDays !== DEATH_PENALTY && maxDays !== LIFE_IMPRISONMENT) {
                        maxDays = Math.max(0, maxDays - ONE_MONTH_DAYS);
                    } else if (maxDays === LIFE_IMPRISONMENT) {
                        maxDays = TimeConverter.toDays(20, 0);
                    }
                    if (minDays !== LIFE_IMPRISONMENT) minDays = Math.floor(minDays / 2);
                    else { minDays = FIFTEEN_YEARS_DAYS; }
                }

                if (apply59 && minDaysBeforeMitigation !== LIFE_IMPRISONMENT) {
                    const specialMaxDays = Math.max(0, minDaysBeforeMitigation - ONE_MONTH_DAYS);
                    if (maxDays === DEATH_PENALTY || maxDays === LIFE_IMPRISONMENT || specialMaxDays < maxDays) {
                        maxDays = specialMaxDays;
                    }
                }
                
                if (minDays !== LIFE_IMPRISONMENT && maxDays !== DEATH_PENALTY && maxDays !== LIFE_IMPRISONMENT && minDays > maxDays) {
                    maxDays = minDays;
                    statusMsg.textContent = '警告：多次減輕導致上限低於下限，已將上限調整為等於下限。';
                    statusMsg.className = "text-base font-bold text-orange-600 mt-2";
                } else {
                    statusMsg.textContent = '';
                    statusMsg.className = "hidden";
                }
                
                document.getElementById('minResult').textContent = `下限: ${TimeConverter.formatDays(minDays)}`;
                document.getElementById('maxResult').textContent = `上限: ${TimeConverter.formatDays(maxDays)}`;

                calculatedRange = { 
                    min: minDays, 
                    max: maxDays, 
                    isLife: maxDays === LIFE_IMPRISONMENT, 
                    isDeath: maxDays === DEATH_PENALTY
                };

                document.getElementById('divideZonesBtn').disabled = false;
                zoneDataStore = []; 

            } catch (error) {
                console.error(error);
                statusMsg.textContent = `計算錯誤：${error.message}`;
                statusMsg.className = "text-base font-bold text-red-700 mt-2";
            }
        }

        // --- 區分區間並直接產出投影片 ---
        function divideSentencingZones() {
            const min = calculatedRange.min;
            const max = calculatedRange.max;
            const errorOutput = document.getElementById('zoneErrorOutput');
            
            errorOutput.classList.add('hidden');
            document.getElementById('slidePresentation').classList.add('hidden');

            if (min === LIFE_IMPRISONMENT) {
                errorOutput.textContent = '區間劃分失敗：下限為無期徒刑，不提供本項功能。';
                errorOutput.classList.remove('hidden');
                return;
            }
            
            let zones = [];
            let totalFixedTermDays;
            
            const isDeath = calculatedRange.isDeath;
            const isLife = calculatedRange.isLife;

            // 1. 全有期徒刑狀況
            if (max !== DEATH_PENALTY && max !== LIFE_IMPRISONMENT) {
                totalFixedTermDays = max - min;
                const interval = Math.floor(totalFixedTermDays / 5);
                let currentMin = min;
                const zoneNames = ['極輕度', '輕度', '中度', '重度', '極重度'];
                for (let i = 0; i < 5; i++) {
                    let zoneMax = (i === 4) ? max : currentMin + interval - 1; 
                    if (zoneMax >= max) zoneMax = max;
                    zones.push({ name: zoneNames[i], min: currentMin, max: zoneMax });
                    currentMin = zoneMax + 1;
                }
            } 
            // 2. 含死刑 或 無期徒刑
            else if (isDeath || isLife) {
                let fixedTermMax;
                
                // 邏輯修正：當包含 Life/Death 時，有期徒刑天花板設為 15 年
                fixedTermMax = TimeConverter.toDays(15, 0);

                if (isDeath) {
                    // 死刑 + 無期 + 有期 (5個區間: Death, Life, Fixed*3)
                    
                    // 1. 死刑 (極重度)
                    zones.push({ name: '極重度 (死刑)', min: DEATH_PENALTY, max: DEATH_PENALTY, isSpecial: true });
                    
                    // 2. 無期徒刑 (重度)
                    zones.push({ name: '重度', min: LIFE_IMPRISONMENT, max: LIFE_IMPRISONMENT, isSpecial: true }); 
                    
                    // 3. 剩下的區間 (Zone 1, 2, 3) 用來分有期徒刑 (MinDays 到 15年)
                    const effectiveMax = fixedTermMax;
                    totalFixedTermDays = effectiveMax - min;
                    
                    if (totalFixedTermDays <= 0) {
                         errorOutput.textContent = '區間劃分失敗：有效有期徒刑區間過小 (Min >= 15年?)。';
                         errorOutput.classList.remove('hidden');
                         return;
                    }

                    const interval = Math.floor(totalFixedTermDays / 3); // 剩 3 個區間
                    let currentMin = min;
                    const remainingZoneNames = ['極輕度', '輕度', '中度'];
                    
                    let fixedZones = [];
                    for (let i = 0; i < 3; i++) {
                        let zoneMax = (i === 2) ? effectiveMax : currentMin + interval - 1;
                        if (zoneMax >= effectiveMax) zoneMax = effectiveMax;
                        fixedZones.push({ name: remainingZoneNames[i], min: currentMin, max: zoneMax });
                        currentMin = zoneMax + 1;
                    }
                    
                    // 重組 (確保順序是 極輕度 -> 中度 -> 重度 -> 極重度)
                    const deathZone = zones.shift();
                    const lifeZone = zones.shift();
                    zones = [...fixedZones, lifeZone, deathZone];


                } else { 
                    // 只有無期徒刑 (沒有死刑) (5個區間: Life, Fixed*4)
                    // Rule 7(4): 平均分成5等分, 無期徒刑在 "極重度"
                    
                    // 1. 極重度: 無期徒刑
                    zones.push({ name: '極重度', min: LIFE_IMPRISONMENT, max: LIFE_IMPRISONMENT, isSpecial: true });
                    
                    // 2. 剩下的 4 個區間分有期徒刑
                    const effectiveMax = fixedTermMax;
                    totalFixedTermDays = effectiveMax - min;
                    
                    if (totalFixedTermDays <= 0) {
                         errorOutput.textContent = '區間劃分失敗：有效有期徒刑區間過小。';
                         errorOutput.classList.remove('hidden');
                         return;
                    }

                    const interval = Math.floor(totalFixedTermDays / 4); // 剩 4 個區間
                    let currentMin = min;
                    const remainingZoneNames = ['極輕度', '輕度', '中度', '重度'];
                    
                    let fixedZones = [];
                    for (let i = 0; i < 4; i++) {
                        let zoneMax = (i === 3) ? effectiveMax : currentMin + interval - 1;
                        if (zoneMax >= effectiveMax) zoneMax = effectiveMax;
                        fixedZones.push({ name: remainingZoneNames[i], min: currentMin, max: zoneMax });
                        currentMin = zoneMax + 1;
                    }
                    
                    // 重組 (確保順序是 極輕度 -> 重度 -> 極重度(Life))
                    const exHeavyZone = zones.shift();
                    zones = [...fixedZones, exHeavyZone];
                }
            }

            zoneDataStore = zones;
            generateSlide();
        }

        // --- 產出「素雅大方」投影片 ---
        function generateSlide() {
            const zones = zoneDataStore;
            const slideContentDiv = document.getElementById('slideContent');
            
            if (!zones || zones.length === 0) return;

            let rangeText = '';
            if (calculatedRange.max !== 0) {
                 rangeText = `量刑範圍：${TimeConverter.formatDays(calculatedRange.min)} ~ ${TimeConverter.formatDays(calculatedRange.max)}`;
            }

            const colorMap = {
                '極重度': 'bg-red-800',           
                '極重度 (死刑)': 'bg-gray-900',  
                '重度': 'bg-red-600',             
                '中度': 'bg-yellow-600',          
                '輕度': 'bg-teal-600',            
                '極輕度': 'bg-blue-700',          
            };

            let html = `
                <div class="text-center mb-10">
                    <h1 class="text-4xl font-bold text-gray-800 mb-3 slide-title-font" contenteditable="true" spellcheck="false">量刑區間分析</h1>
                    <p class="text-lg text-gray-500 font-medium tracking-wide" contenteditable="true" spellcheck="false">${rangeText}</p>
                </div>
                <div class="space-y-2 border-t border-b border-gray-100 py-4">
            `;

            // 列表生成 (嚴格遵守 重 -> 輕)
            zones.slice().reverse().forEach(zone => {
                let displayStr = '';
                
                if (zone.min === DEATH_PENALTY) {
                    displayStr = "死刑";
                } else if (zone.max === LIFE_IMPRISONMENT) {
                    if (zone.min === LIFE_IMPRISONMENT) {
                         displayStr = "無期徒刑";
                    } else {
                        const minStr = TimeConverter.formatDays(zone.min);
                        displayStr = `${minStr} ~ 無期徒刑`;
                    }
                } else {
                    const minStr = TimeConverter.formatDays(zone.min);
                    const maxStr = TimeConverter.formatDays(zone.max);
                    displayStr = `${minStr} ~ ${maxStr}`;
                }

                const indicatorColor = colorMap[zone.name] || 'bg-gray-500';

                html += `
                    <div class="zone-row group">
                        <div class="zone-indicator ${indicatorColor} shrink-0"></div>
                        <div class="w-32 text-xl font-bold text-gray-800 slide-title-font shrink-0" contenteditable="true" spellcheck="false">${zone.name}</div>
                        <div class="flex-grow text-right text-lg text-gray-600 font-mono tracking-tight" contenteditable="true" spellcheck="false">
                            ${displayStr}
                        </div>
                    </div>
                `;
            });

            html += `
                </div>
                <div class="mt-8 flex justify-between items-end">
                     <p class="text-xs text-gray-400" contenteditable="true" spellcheck="false">註：區間劃分僅供參考，實際量刑視個案而定。</p>
                     <p class="text-xs text-gray-300 font-serif italic" contenteditable="true">Sentencing Range Analysis</p>
                </div>
            `;

            slideContentDiv.innerHTML = html;
            document.getElementById('slidePresentation').classList.remove('hidden');
            
            setTimeout(() => {
                document.getElementById('slidePresentation').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }
    </script>
</body>
</html>